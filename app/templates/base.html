{% macro render_csrf() %}
    {{ csrf_token() }}
{% endmacro %}
<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='change-theme-advanced.css') }}">
    {% block styles %}{% endblock %}
    <!-- Eliminado sistema de tema claro/oscuro -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tienda Virtual{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/star-bg.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home-cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/utilities.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base-inline.css') }}?v={{ config.get('VERSION', '1.0') }}">
    <!-- SEO y PWA -->
    <meta name="description" content="SAMMS.FO - Tu tienda virtual de productos destacados, sneakers y moda urbana. Compra f√°cil, seguro y r√°pido.">
    <meta name="keywords" content="sneakers, tienda, ecommerce, moda, ofertas, productos, carrito, pedidos, reviews, favoritos">
    <meta name="theme-color" content="#181818">
    <!-- Rich Snippets SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "SAMMS.FO",
        "url": "https://samms.fo/",
        "logo": "https://samms.fo/static/logo.png"
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": "Zapatilla AirMax",
        "image": [
            "https://samms.fo/static/product_images/airmax.jpg"
        ],
        "description": "Zapatilla deportiva AirMax original.",
        "brand": {
            "@type": "Brand",
            "name": "Nike"
        }
    }
    </script>
    <meta property="og:title" content="SAMMS.FO - Tienda Virtual" />
    <meta property="og:description" content="Descubre los mejores productos y ofertas en SAMMS.FO. ¬°Compra f√°cil y seguro!" />
    <meta property="og:image" content="{{ url_for('static', filename='logo.png') }}" />
    <meta property="og:type" content="website" />
    <link rel="manifest" href="/static/manifest.json">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/static/service-worker.js');
        });
      }
    </script>
    {% block head %}{% endblock %}
</head>
<body role="main" tabindex="0" class="content-overlay">
    <div class="stars"></div>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo SAMMS.FO" height="48" style="filter: drop-shadow(0 0 16px #f5f5f5);border-radius:50%;background:#fff;object-fit:cover;" title="Ir al inicio">
            <span class="ms-2">SAMMS.FO</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                {% if current_user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link" href="/" title="Ir al inicio"><span class="d-none d-md-inline">Inicio</span> <span class="d-inline d-md-none" style="font-size:1.2em;">üè†</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/catalog" title="Ver cat√°logo"><span class="d-none d-md-inline">Cat√°logo</span> <span class="d-inline d-md-none" style="font-size:1.2em;">üì¶</span></a></li>
                    <li class="nav-item position-relative">
                        <a class="nav-link" href="/cart" title="Carrito de compras">
                            <span class="d-none d-md-inline">üõí Carrito</span>
                            <span class="d-inline d-md-none" style="font-size:1.2em;">üõí</span>
                            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-glow-white" style="font-size:0.85em;">0</span>
                        </a>
                    </li>
                    <li class="nav-item position-relative">
                        <a class="nav-link" href="/wishlist" title="Favoritos">
                            <span class="d-none d-md-inline">&#10084; Favoritos</span>
                            <span class="d-inline d-md-none" style="font-size:1.2em;">&#10084;</span>
                            {% if session['wishlist_count'] is defined and session['wishlist_count'] > 0 %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-glow-white" style="font-size:0.85em;">{{ session['wishlist_count'] }}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="/orders/history" title="Ver pedidos"><span class="d-none d-md-inline">Pedidos</span> <span class="d-inline d-md-none" style="font-size:1.2em;">üì¶</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/client/profile" title="Mi perfil">
                        <span class="d-none d-md-inline">Perfil</span>
                        <span class="d-inline d-md-none" style="font-size:1.2em;">üë§</span>
                        {% if current_user.is_authenticated and current_user.is_frecuente %}
                            <span class="badge badge-glow-white ms-1" style="font-size:0.85em;" title="Usuario frecuente">‚òÖ</span>
                        {% endif %}
                    </a></li>
                    {% if current_user.role.name == 'ADMIN' %}
                        <li class="nav-item"><a class="nav-link" href="/admin/dashboard">Admin</a></li>
                    {% endif %}
                    <li class="nav-item"><a class="nav-link" href="/logout">Salir</a></li>
                {% else %}
                    <li class="nav-item"><a class="nav-link" href="/" title="Ir al inicio"><span class="d-none d-md-inline">Inicio</span> <span class="d-inline d-md-none" style="font-size:1.2em;">üè†</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/catalog" title="Ver cat√°logo"><span class="d-none d-md-inline">Cat√°logo</span> <span class="d-inline d-md-none" style="font-size:1.2em;">üì¶</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/login">Iniciar sesi√≥n</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
<div class="container fade-in">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
</div>
<!-- Bot√≥n de cambio de tema posicionado fuera del navbar -->
<button class="theme-toggle-advanced"
        title="Cambiar entre tema claro y oscuro"
        aria-label="Cambiar tema de la aplicaci√≥n"
        data-bs-toggle="tooltip"
        data-bs-placement="right">
    <span id="themeIcon" class="icon">üåû</span>
</button>

<script src="{{ url_for('static', filename='js/change-theme-advanced.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/base.js') }}?v={{ config.get('VERSION', '1.0') }}" defer></script>
{% block scripts %}{% endblock %}
<script src="{{ url_for('static', filename='js/star-bg.js') }}"></script>
<script>
// Funci√≥n de debug para verificar el estado del tema (accesible desde consola)
window.debugTheme = function() {
  const status = window.checkThemeStatus();
  console.table(status);

  // Mostrar informaci√≥n visual en la p√°gina
  const debugInfo = document.createElement('div');
  debugInfo.innerHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.9); color: #fff; padding: 20px; border-radius: 10px;
                font-family: monospace; z-index: 10000; max-width: 400px;">
      <h4>üé® Debug Info - Theme System</h4>
      <pre>${JSON.stringify(status, null, 2)}</pre>
      <button onclick="this.parentElement.remove()" style="margin-top: 10px;">Cerrar</button>
    </div>
  `;
  document.body.appendChild(debugInfo);
};
</script>

</body>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/socketio-notify.js') }}"></script>
